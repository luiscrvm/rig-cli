# Monitoring Stack

This monitoring configuration was generated by Rig CLI for devops-cli.

## Components

- **Prometheus**: Metrics collection and alerting
- **Grafana**: Visualization and dashboards  
- **AlertManager**: Alert routing and notification
- **Loki**: Log aggregation
- **Node Exporter**: System metrics
- **Promtail**: Log collection

## Quick Start

### Using Docker Compose

```bash
# Start the monitoring stack
docker-compose -f docker-compose.monitoring.yml up -d

# View services
docker-compose -f docker-compose.monitoring.yml ps

# View logs
docker-compose -f docker-compose.monitoring.yml logs -f grafana
```

### Using Kubernetes

```bash
# Deploy monitoring stack
kubectl apply -f k8s/monitoring-stack.yaml

# Check pods
kubectl get pods -n monitoring

# Access services
kubectl port-forward -n monitoring svc/prometheus 9090:9090
kubectl port-forward -n monitoring svc/grafana 3000:3000
```

## Access URLs

- **Grafana**: http://localhost:3000 (admin/grafana)
- **Prometheus**: http://localhost:9090
- **AlertManager**: http://localhost:9093

## Dashboards

### Application Dashboard
- Request rate and response times
- Error rates and status codes
- Active users and business metrics

### Infrastructure Dashboard  
- CPU, memory, and disk usage
- Network I/O and system load
- Container and pod metrics

## Alerts

### Critical Alerts
- Application down
- High error rate (>10%)
- Database connection issues

### Warning Alerts
- High response time (>500ms)
- High resource usage (>80%)
- Event loop lag (Node.js)

## Customization

### Adding Custom Metrics

1. **Application Metrics**:
   Configure metrics collection based on your application stack

2. **Custom Dashboards**:
   - Add JSON files to `grafana/dashboards/`
   - Configure in `grafana/provisioning/dashboards/`

3. **Custom Alerts**:
   - Edit `prometheus/alerts.yml`
   - Configure notifications in `alertmanager/alertmanager.yml`

### Environment Configuration

Copy and customize:
```bash
cp .env.monitoring.example .env.monitoring
```

## Troubleshooting

### Common Issues

1. **Prometheus can't scrape metrics**:
   - Check if application exposes `/metrics` endpoint
   - Verify network connectivity between containers

2. **Grafana shows "No data"**:
   - Verify Prometheus datasource configuration
   - Check time range in dashboard queries

3. **Alerts not firing**:
   - Check alert expression syntax
   - Verify AlertManager webhook URLs

### Useful Commands

```bash
# Check Prometheus targets
curl http://localhost:9090/api/v1/targets

# Test AlertManager config
docker exec alertmanager amtool config check

# View Grafana logs
docker logs grafana
```

## Generated by Rig CLI

This monitoring configuration was automatically generated by Rig CLI.
- Run `rig generate monitoring` to regenerate
- Run `rig security --scan` to check for security issues
- Run `rig cost --analyze` to analyze monitoring costs
